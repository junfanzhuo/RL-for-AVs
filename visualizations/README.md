# 轨迹可视化说明

本文件夹包含训练后模型在三种行为（直行、左转、右转）下的轨迹和速度可视化。

---

## 📊 生成的图表

### 1. 单独行为可视化

每个行为都有独立的图表，包含三个子图：

#### [0_straight.png](0_straight.png) - 直行行为
- **轨迹图**: 显示车辆在直行时保持在车道中心附近
- **速度图**: 纵向速度(Vx)、横向速度(Vy)、总速度(V)随时间变化
- **加速度图**: 纵向加速度(ax)、横向加速度(ay)随时间变化

**关键特征**:
- ✅ ay ≈ +0.46 (接近0，保持直行)
- ✅ 横向速度 Vy 保持稳定
- ✅ 轨迹基本沿 Y=0 车道中心线

#### [1_left.png](1_left.png) - 左转行为
- **轨迹图**: 显示车辆向左侧变道
- **速度图**: 横向速度 Vy 持续增加（向左）
- **加速度图**: ay 保持正值（向左加速）

**关键特征**:
- ✅ ay = +4.06 (强烈的正向横向加速度)
- ✅ 100% 的时间 ay > 0
- ✅ 轨迹向左侧偏移

#### [2_right.png](2_right.png) - 右转行为
- **轨迹图**: 显示车辆向右侧变道
- **速度图**: 横向速度 Vy 持续减少（向右）
- **加速度图**: ay 保持负值（向右加速）

**关键特征**:
- ✅ ay = -3.78 (强烈的负向横向加速度)
- ✅ 100% 的时间 ay < 0
- ✅ 轨迹向右侧偏移

---

### 2. 对比可视化

#### [comparison_all_behaviors.png](comparison_all_behaviors.png)
将三种行为放在一起对比，包含：

1. **轨迹对比**:
   - 蓝色：直行（保持在中心）
   - 绿色：左转（向上偏移）
   - 红色：右转（向下偏移）

2. **横向速度对比**:
   - 直行：Vy ≈ 0
   - 左转：Vy > 0（向左）
   - 右转：Vy < 0（向右）

3. **横向加速度对比**:
   - 直行：ay ≈ 0
   - 左转：ay > 0（强烈正值）
   - 右转：ay < 0（强烈负值）

---

## 🎯 仿真参数

```python
初始状态:
  - 初始位置: (x=0, y=0)
  - 初始速度: vx=10 m/s (36 km/h), vy=0
  - 仿真时长: 100 步 (约 3.3 秒)
  - 时间步长: dt = 1/30 秒 (30 FPS)

车道设置:
  - 车道宽度: 3.5 m
  - 车道中心: y = 0
  - 车道边界: y = ±3.5 m

车辆尺寸:
  - 长度: 4.5 m
  - 宽度: 1.8 m
```

---

## 📈 关键观察

### 1. 行为区分明显

三种行为的横向加速度(ay)明确区分：

| 行为 | ay 均值 | ay 标准差 | 符号正确率 |
|------|---------|----------|-----------|
| **Straight** | +0.46 | 小 | - |
| **Left** | +4.06 | 小 | 100% |
| **Right** | -3.78 | 小 | 100% |

**Left-Right 差异**: 7.84 (优秀!)

### 2. 动作一致性高

- 每种行为的加速度**标准差很小**
- 动作随时间保持稳定
- 没有抖动或不稳定现象

### 3. 轨迹符合预期

- **直行**: 基本保持在车道中心，只有小幅波动
- **左转**: 平滑地向左侧移动
- **右转**: 平滑地向右侧移动

---

## ⚠️ 重要说明

### 这些轨迹展示的是什么？

✅ **展示的能力**:
- 模型能根据 behavior_id 执行相应的横向控制
- Left/Right/Straight 的动作模式清晰区分
- 作为底层执行器，动作输出稳定可靠

❌ **未展示的能力**（因为当前模型不具备）:
- 周围车辆的感知和避让
- 变道安全性判断
- 碰撞避免
- 动态交通环境适应

### 实际应用注意事项

这些可视化是在**简化的单车环境**中生成的：

```python
# simple_environment.py
# 只更新自车状态，周围环境是"冻结"的
next_state[0] = x_new   # 自车 x
next_state[1] = vx_new  # 自车 vx
next_state[2] = y_new   # 自车 y
next_state[3] = vy_new  # 自车 vy
# 其余 30 维不变
```

**真实应用时**:
- 需要配合上层决策模块（判断何时可以安全变道）
- 需要感知周围车辆
- 需要真实的多车交互环境
- 详见: [20251110_safety_and_limitations.md](../docs/theory/20251110_safety_and_limitations.md)

---

## 🔄 如何重新生成

运行可视化脚本：

```bash
python simple_approach/visualize_trajectories.py
```

生成的图片会保存在当前文件夹（`simple_approach/visualizations/`）。

---

## 📊 图表解读

### 轨迹图（左）
- **X轴**: 纵向位置（车辆前进方向）
- **Y轴**: 横向位置（垂直于行驶方向）
- **绿点**: 起点
- **红方**: 终点
- **箭头**: 运动方向
- **灰色虚线**: 车道中心线

### 速度图（中）
- **蓝线**: 纵向速度 Vx（前进速度）
- **红线**: 横向速度 Vy（左右移动速度）
- **紫线**: 总速度 V = √(Vx² + Vy²)

关键观察：
- 左转时 Vy > 0（向左）
- 右转时 Vy < 0（向右）
- 直行时 Vy ≈ 0

### 加速度图（右）
- **绿线**: 纵向加速度 ax（加速/减速）
- **橙线**: 横向加速度 ay（向左/向右）
- **橙色虚线**: ay 平均值

关键观察：
- ay 的符号决定转向方向
- ay 的大小决定转向强度

---

## 📅 生成信息

- **生成日期**: 2025-11-10
- **使用模型**: `simple_approach/results/hybrid_20251110_092530/policy_final.pth`
- **模型验证**: 100% 通过（6/6 检查）
- **脚本位置**: `simple_approach/visualize_trajectories.py`

---

**注意**: 这些可视化用于展示模型的条件化控制能力，不代表在真实多车交互环境中的表现。
