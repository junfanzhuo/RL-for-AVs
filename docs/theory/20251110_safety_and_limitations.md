# å½“å‰å®ç°çš„å®‰å…¨æ€§åˆ†æä¸å±€é™æ€§

æ—¥æœŸ: 2025-11-10

---

## â“ æ ¸å¿ƒé—®é¢˜

1. **è®­ç»ƒæ—¶æ˜¯å¦è€ƒè™‘å‘¨å›´è½¦è¾†ï¼Ÿ**
2. **ç”Ÿæˆçš„æ•°æ®æ˜¯å¦åŒ…å«å‘¨å›´è½¦ä¿¡æ¯ï¼Ÿ**
3. **Environment æ˜¯å¦è€ƒè™‘å‘¨å›´è½¦è¾†ï¼Ÿ**
4. **å‘¨å›´è½¦è¾†å¦‚ä½•è¡Œé©¶ï¼Ÿ**

---

## ğŸ” å½“å‰å®ç°çš„çœŸå®æƒ…å†µ

### é—®é¢˜ 1 & 2: æ•°æ®ä¸­çš„å‘¨å›´è½¦ä¿¡æ¯

**å›ç­”**: âŒ **å½“å‰çš„åˆæˆæ•°æ®å‡ ä¹æ²¡æœ‰è€ƒè™‘å‘¨å›´è½¦è¾†çš„çœŸå®äº¤äº’**

#### æ•°æ®ç”Ÿæˆæ–¹å¼åˆ†æ

æŸ¥çœ‹ `generate_truly_synthetic_data.py`:

```python
# ç”ŸæˆéšæœºçŠ¶æ€ (34ç»´)
state = np.random.randn(state_dim).astype(np.float32)
state[0] = state[0] * 82 + 143  # x
state[1] = state[1] * 2.1 + 8.7  # vx
state[2] = state[2] * 3.7 + 18.7  # y_rel
# ... å…¶ä½™31ç»´éƒ½æ˜¯éšæœºå™ªå£°ï¼
```

**é—®é¢˜**:
- State è™½ç„¶æ˜¯ 34 ç»´ï¼Œä½†ç”Ÿæˆæ—¶**åªè®¾ç½®äº†å‰3ç»´æœ‰æ„ä¹‰çš„å€¼**ï¼ˆx, vx, y_relï¼‰
- å…¶ä½™ç»´åº¦éƒ½æ˜¯**éšæœºé«˜æ–¯å™ªå£°**ï¼Œæ²¡æœ‰å®é™…ç‰©ç†æ„ä¹‰
- **å®Œå…¨æ²¡æœ‰è€ƒè™‘å‘¨å›´è½¦è¾†çš„ä½ç½®ã€é€Ÿåº¦ã€è¡Œä¸º**

#### çœŸå® NGSIM æ•°æ®åº”è¯¥åŒ…å«ä»€ä¹ˆï¼Ÿ

å¦‚æœä½¿ç”¨çœŸå®çš„ NGSIM æ•°æ®ï¼Œ34 ç»´ state åº”è¯¥åŒ…å«ï¼š

```python
State (34ç»´) å¯èƒ½åŒ…å«:
  è‡ªè½¦ä¿¡æ¯ (4-6ç»´):
    - x, y: ä½ç½®
    - vx, vy: é€Ÿåº¦
    - ax, ay: åŠ é€Ÿåº¦

  å‘¨å›´è½¦è¾†ä¿¡æ¯ (æ¯è¾†è½¦çº¦6-8ç»´):
    - å‰è½¦ (front): x_rel, y_rel, vx_rel, vy_rel, ...
    - å·¦å‰è½¦ (front_left): ...
    - å³å‰è½¦ (front_right): ...
    - åè½¦ (rear): ...
    - å·¦åè½¦ (rear_left): ...
    - å³åè½¦ (rear_right): ...

  é“è·¯ä¿¡æ¯:
    - è½¦é“çº¿ä½ç½®
    - è½¦é“æ•°é‡
    - ...
```

**ä½†å½“å‰åˆæˆæ•°æ®**:
- âŒ æ²¡æœ‰æ˜ç¡®çš„å‘¨å›´è½¦è¾†ä¿¡æ¯
- âŒ æ²¡æœ‰ç›¸å¯¹ä½ç½®å’Œç›¸å¯¹é€Ÿåº¦
- âŒ åªæ˜¯éšæœºå™ªå£°å¡«å…… 34 ç»´

---

### é—®é¢˜ 3 & 4: Environment ä¸­çš„å‘¨å›´è½¦è¾†

**å›ç­”**: âŒ **Environment å®Œå…¨æ²¡æœ‰è€ƒè™‘å‘¨å›´è½¦è¾†ï¼Œä¹Ÿæ²¡æœ‰æ¨¡æ‹Ÿå‘¨å›´è½¦è¾†çš„è¿åŠ¨**

#### Environment çš„å®ç°åˆ†æ

æŸ¥çœ‹ `simple_environment.py`:

```python
def step(self, action):
    # åªæ›´æ–°è‡ªè½¦çš„çŠ¶æ€
    ax, ay = action[0], action[1]

    # å½“å‰çŠ¶æ€
    x, vx, y_rel, vy = self.current_state[0:4]

    # ç®€å•çš„è¿åŠ¨å­¦æ›´æ–°ï¼ˆåªæ›´æ–°å‰4ç»´ï¼ï¼‰
    dt = 1/30
    vx_new = vx + ax * dt
    vy_new = vy + ay * dt
    x_new = x + vx * dt
    y_rel_new = y_rel + vy * dt

    # æ›´æ–°çŠ¶æ€ï¼ˆä¿æŒå…¶ä»–ç»´åº¦ä¸å˜ï¼‰
    next_state = self.current_state.copy()
    next_state[0] = x_new
    next_state[1] = vx_new
    next_state[2] = y_rel_new
    next_state[3] = vy_new
    # å…¶ä½™30ç»´ä¿æŒä¸å˜ï¼
```

**é—®é¢˜**:
- âŒ åªæ›´æ–°è‡ªè½¦çš„ x, vx, y_rel, vyï¼ˆå‰4ç»´ï¼‰
- âŒ **å…¶ä½™30ç»´å®Œå…¨ä¸å˜**ï¼Œæ²¡æœ‰åŠ¨æ€æ›´æ–°
- âŒ **æ²¡æœ‰ä»»ä½•å‘¨å›´è½¦è¾†çš„è¿åŠ¨æ¨¡å‹**
- âŒ å‘¨å›´è½¦è¾†çŠ¶æ€æ˜¯"å†»ç»“"çš„ï¼Œä¸ä¼šéšæ—¶é—´å˜åŒ–

#### Collision æ£€æµ‹

```python
def _check_collision(self, state):
    y_rel = state[2]
    # å¦‚æœ |y_rel| > 5mï¼Œè®¤ä¸ºå·²ç»åç¦»å¤ªè¿œ
    if abs(y_rel) > 5.0:
        return True
    return False
```

**é—®é¢˜**:
- âŒ åªæ£€æŸ¥æ¨ªå‘ä½ç½®æ˜¯å¦è¶…å‡ºèŒƒå›´
- âŒ **æ²¡æœ‰æ£€æŸ¥æ˜¯å¦ä¸å‘¨å›´è½¦è¾†ç¢°æ’**
- âŒ æ²¡æœ‰è€ƒè™‘çºµå‘ç¢°æ’ï¼ˆè¿½å°¾ï¼‰
- âŒ æ²¡æœ‰è€ƒè™‘ä¾§å‘ç¢°æ’ï¼ˆå˜é“æ—¶ï¼‰

---

## ğŸš¨ å®‰å…¨æ€§é—®é¢˜åˆ†æ

### å½“å‰æ¨¡å‹çš„å®‰å…¨éšæ‚£

#### 1. **å˜é“å®‰å…¨é—®é¢˜**

**é—®é¢˜**: æ¨¡å‹å­¦ä¼šäº†"å·¦è½¬æ—¶ ay > 0ï¼Œå³è½¬æ—¶ ay < 0"ï¼Œä½†**å®Œå…¨æ²¡æœ‰å­¦ä¹ ä½•æ—¶å¯ä»¥å®‰å…¨å˜é“**

```python
# å½“å‰æ¨¡å‹çš„è¡Œä¸º
if behavior_id == 2:  # Right
    action = [ax, -3.78]  # æ€»æ˜¯è¾“å‡ºè´Ÿçš„ ay
    # é—®é¢˜: ä¸ç®¡å³ä¾§æœ‰æ²¡æœ‰è½¦ï¼Œéƒ½ä¼šå‘å³è½¬ï¼
```

**å±é™©åœºæ™¯**:
- å³ä¾§æœ‰è½¦æ—¶ä»ç„¶å‘å³å˜é“ â†’ **ç¢°æ’**
- ç›²åŒºæœ‰è½¦æ—¶å˜é“ â†’ **ç¢°æ’**
- åæ–¹æœ‰é«˜é€Ÿè½¦è¾†æ¥è¿‘æ—¶å˜é“ â†’ **è¢«è¿½å°¾**

#### 2. **æ— æ³•æ„ŸçŸ¥å‘¨å›´è½¦è¾†**

ç”±äºæ•°æ®å’Œç¯å¢ƒéƒ½æ²¡æœ‰çœŸå®çš„å‘¨å›´è½¦è¾†ä¿¡æ¯ï¼Œæ¨¡å‹ï¼š
- âŒ æ— æ³•åˆ¤æ–­å‘¨å›´æ˜¯å¦æœ‰è½¦
- âŒ æ— æ³•åˆ¤æ–­å˜é“æ˜¯å¦å®‰å…¨
- âŒ æ— æ³•é¢„æµ‹å‘¨å›´è½¦è¾†çš„è¡Œä¸º
- âŒ æ— æ³•ä¿æŒå®‰å…¨è·ç¦»

#### 3. **åªå­¦ä¼šäº†"å¦‚ä½•è½¬"ï¼Œæ²¡å­¦ä¼š"ä½•æ—¶è½¬"**

```
å½“å‰æ¨¡å‹å­¦åˆ°çš„:
  Left behavior  â†’ ay = +4.0  (å‘å·¦è½¬)
  Right behavior â†’ ay = -3.8  (å‘å³è½¬)
  Straight       â†’ ay = +0.5  (ä¿æŒ)

æ²¡æœ‰å­¦åˆ°çš„:
  - ä»€ä¹ˆæ—¶å€™å¯ä»¥å®‰å…¨å˜é“ï¼Ÿ
  - å‘¨å›´æœ‰è½¦æ—¶è¯¥æ€ä¹ˆåŠï¼Ÿ
  - å¦‚ä½•é¿è®©å…¶ä»–è½¦è¾†ï¼Ÿ
  - å¦‚ä½•ä¿æŒå®‰å…¨è·Ÿè½¦è·ç¦»ï¼Ÿ
```

---

## ğŸ“Š ä¸çœŸå®é©¾é©¶çš„å¯¹æ¯”

| ç»´åº¦ | çœŸå®é©¾é©¶éœ€æ±‚ | å½“å‰æ¨¡å‹ | çŠ¶æ€ |
|------|------------|---------|------|
| **æ„ŸçŸ¥å‘¨å›´è½¦è¾†** | å¿…é¡» | âŒ æ—  | ä¸æ»¡è¶³ |
| **ç¢°æ’æ£€æµ‹** | å¿…é¡» | âŒ ä»…æ£€æŸ¥è½¦é“è¾¹ç•Œ | ä¸æ»¡è¶³ |
| **å˜é“å®‰å…¨åˆ¤æ–­** | å¿…é¡» | âŒ æ—  | ä¸æ»¡è¶³ |
| **ä¿æŒå®‰å…¨è·ç¦»** | å¿…é¡» | âŒ æ—  | ä¸æ»¡è¶³ |
| **é¢„æµ‹ä»–è½¦è¡Œä¸º** | é‡è¦ | âŒ æ—  | ä¸æ»¡è¶³ |
| **æ‰§è¡ŒåŸºæœ¬åŠ¨ä½œ** | å¿…é¡» | âœ… å¯ä»¥ | æ»¡è¶³ |

---

## ğŸ¯ å½“å‰æ¨¡å‹çš„å®é™…èƒ½åŠ›

### âœ… æ¨¡å‹èƒ½åšä»€ä¹ˆ

1. **å­¦ä¼šäº†åŸºæœ¬çš„æ¨ªå‘æ§åˆ¶**:
   - ç›´è¡Œæ—¶ä¿æŒæ¨ªå‘åŠ é€Ÿåº¦æ¥è¿‘0
   - å·¦è½¬æ—¶äº§ç”Ÿæ­£å‘æ¨ªå‘åŠ é€Ÿåº¦
   - å³è½¬æ—¶äº§ç”Ÿè´Ÿå‘æ¨ªå‘åŠ é€Ÿåº¦

2. **æ ¹æ® behavior_id æ‰§è¡Œç›¸åº”åŠ¨ä½œ**:
   - å¯ä»¥ä½œä¸º**åº•å±‚æ‰§è¡Œå™¨**ä½¿ç”¨
   - ç»™å®šè¡Œä¸ºæ„å›¾ï¼Œè¾“å‡ºç›¸åº”çš„æ§åˆ¶ä¿¡å·

3. **åŠ¨ä½œä¸€è‡´æ€§å¥½**:
   - Left: 100% çš„æ ·æœ¬ ay > 0
   - Right: 100% çš„æ ·æœ¬ ay < 0

### âŒ æ¨¡å‹ä¸èƒ½åšä»€ä¹ˆ

1. **æ— æ³•åˆ¤æ–­å˜é“å®‰å…¨æ€§**
2. **æ— æ³•æ„ŸçŸ¥å‘¨å›´è½¦è¾†**
3. **æ— æ³•é¿å…ç¢°æ’**
4. **æ— æ³•ä¿æŒå®‰å…¨è·ç¦»**
5. **æ— æ³•é€‚åº”åŠ¨æ€äº¤é€šç¯å¢ƒ**

---

## ğŸ—ï¸ å½“å‰æ¨¡å‹çš„å®šä½

### æ­£ç¡®çš„ä½¿ç”¨æ–¹å¼

å½“å‰æ¨¡å‹åº”è¯¥ä½œä¸º **Low-Level Controllerï¼ˆåº•å±‚æ§åˆ¶å™¨ï¼‰**:

```
High-Level Planner (ä¸Šå±‚è§„åˆ’å™¨)
  â†“
  å†³ç­–: ä»€ä¹ˆæ—¶å€™å¯ä»¥å®‰å…¨å˜é“ï¼Ÿ
  è¾“å…¥: å‘¨å›´è½¦è¾†ä¿¡æ¯ã€äº¤é€šçŠ¶å†µ
  è¾“å‡º: behavior_id (0/1/2)

  â†“

Conditional Policy (å½“å‰æ¨¡å‹ - åº•å±‚æ‰§è¡Œå™¨)
  â†“
  æ‰§è¡Œ: å¦‚ä½•æ‰§è¡Œå˜é“åŠ¨ä½œï¼Ÿ
  è¾“å…¥: state + behavior_id
  è¾“å‡º: action (ax, ay)
```

### éœ€è¦é…åˆçš„ä¸Šå±‚æ¨¡å—

éœ€è¦ä¸€ä¸ª**å®‰å…¨çš„å†³ç­–å±‚**æ¥ï¼š

1. **æ„ŸçŸ¥ç¯å¢ƒ**:
   - æ£€æµ‹å‘¨å›´è½¦è¾†ä½ç½®å’Œé€Ÿåº¦
   - é¢„æµ‹å‘¨å›´è½¦è¾†è¡Œä¸º
   - è¯„ä¼°äº¤é€šå¯†åº¦

2. **å®‰å…¨è¯„ä¼°**:
   - åˆ¤æ–­å·¦/å³ä¾§æ˜¯å¦æœ‰è½¦
   - è®¡ç®—ç¢°æ’é£é™©
   - è¯„ä¼°å˜é“å®‰å…¨æ€§

3. **è¡Œä¸ºå†³ç­–**:
   - å†³å®šä½•æ—¶ä¿æŒç›´è¡Œï¼ˆbehavior=0ï¼‰
   - å†³å®šä½•æ—¶å¯ä»¥å®‰å…¨å·¦è½¬ï¼ˆbehavior=1ï¼‰
   - å†³å®šä½•æ—¶å¯ä»¥å®‰å…¨å³è½¬ï¼ˆbehavior=2ï¼‰

---

## ğŸ”§ æ”¹è¿›æ–¹å‘

### çŸ­æœŸæ”¹è¿›ï¼ˆä¸æ”¹å˜æ¶æ„ï¼‰

1. **ä½¿ç”¨çœŸå® NGSIM æ•°æ®è®­ç»ƒ**:
   - ä¿ç•™å‘¨å›´è½¦è¾†ä¿¡æ¯
   - ä½¿ç”¨çœŸå®çš„ state (34ç»´å…¨éƒ¨æœ‰æ„ä¹‰)
   - å­¦ä¹ çœŸå®çš„é©¾é©¶æ¨¡å¼

2. **æ·»åŠ å®‰å…¨æ€§ Reward**:
   ```python
   # åœ¨ reward ä¸­åŠ å…¥å®‰å…¨è€ƒè™‘
   if distance_to_nearest_car < safe_distance:
       reward -= 10.0  # æƒ©ç½šæ¥è¿‘ç¢°æ’

   if changing_lane and side_car_exists:
       reward -= 20.0  # æƒ©ç½šä¸å®‰å…¨å˜é“
   ```

3. **æ”¹è¿› Environment**:
   - æ¨¡æ‹Ÿå‘¨å›´è½¦è¾†è¿åŠ¨
   - æ·»åŠ çœŸå®çš„ç¢°æ’æ£€æµ‹
   - åŸºäºçœŸå®äº¤é€šæµæ¨¡å‹

### é•¿æœŸæ”¹è¿›ï¼ˆæ¶æ„å‡çº§ï¼‰

1. **ä¸¤å±‚æ¶æ„**:
   ```
   High-Level: å†³ç­–å±‚ï¼ˆè€ƒè™‘å®‰å…¨æ€§ï¼‰
      - è¾“å…¥: å®Œæ•´çš„å‘¨å›´è½¦è¾†ä¿¡æ¯
      - è¾“å‡º: å®‰å…¨çš„ behavior_id
      - æ–¹æ³•: Rule-based / RL / CPT

   Low-Level: æ‰§è¡Œå±‚ï¼ˆå½“å‰æ¨¡å‹ï¼‰
      - è¾“å…¥: state + behavior_id
      - è¾“å‡º: action
      - æ–¹æ³•: Conditional Policy (å·²å®Œæˆ)
   ```

2. **é›†æˆ CPT æ¡†æ¶**:
   - CPT è´Ÿè´£é«˜å±‚å†³ç­–ï¼ˆè€ƒè™‘é©¾é©¶å‘˜ç‰¹å¾ã€å®‰å…¨æ€§ï¼‰
   - Conditional Policy è´Ÿè´£åº•å±‚æ‰§è¡Œ

3. **å¤šæ™ºèƒ½ä½“è®­ç»ƒ**:
   - åœ¨å¤šè½¦äº¤äº’ç¯å¢ƒä¸­è®­ç»ƒ
   - å­¦ä¹ é¿è®©ã€è·Ÿè½¦ã€å®‰å…¨å˜é“
   - è€ƒè™‘å…¶ä»–è½¦è¾†çš„ååº”

---

## ğŸ“‹ ç»“è®º

### å›ç­”ä½ çš„é—®é¢˜

#### Q1: è®­ç»ƒæ—¶æ˜¯å¦è€ƒè™‘å‘¨å›´è½¦çš„æƒ…å†µï¼Ÿ
**A1**: âŒ **æ²¡æœ‰**ã€‚å½“å‰ä½¿ç”¨çš„åˆæˆæ•°æ®ä¸­ï¼Œ34ç»´ state åªæœ‰å‰å‡ ç»´æ˜¯æœ‰æ„ä¹‰çš„è‡ªè½¦ä¿¡æ¯ï¼Œå…¶ä½™ç»´åº¦æ˜¯éšæœºå™ªå£°ï¼Œ**æ²¡æœ‰çœŸå®çš„å‘¨å›´è½¦è¾†ä¿¡æ¯**ã€‚

#### Q2: ç”Ÿæˆæ•°æ®æ˜¯å¦åŒ…å«å‘¨å›´è½¦ä¿¡æ¯ï¼Ÿ
**A2**: âŒ **æ²¡æœ‰**ã€‚`generate_truly_synthetic_data.py` ç”Ÿæˆçš„æ•°æ®ä¸­ï¼Œstate çš„å¤§éƒ¨åˆ†ç»´åº¦éƒ½æ˜¯éšæœºé«˜æ–¯å™ªå£°ï¼Œ**ä¸åŒ…å«å‘¨å›´è½¦è¾†çš„ä½ç½®ã€é€Ÿåº¦ç­‰ä¿¡æ¯**ã€‚

#### Q3: Environment æ˜¯å¦è€ƒè™‘å‘¨å›´è½¦ï¼Ÿ
**A3**: âŒ **æ²¡æœ‰**ã€‚`simple_environment.py` åªæ›´æ–°è‡ªè½¦çš„å‰4ç»´çŠ¶æ€ï¼ˆx, vx, y_rel, vyï¼‰ï¼Œ**æ²¡æœ‰æ¨¡æ‹Ÿå‘¨å›´è½¦è¾†çš„è¿åŠ¨**ï¼Œå…¶ä½™30ç»´çŠ¶æ€ä¿æŒä¸å˜ã€‚

#### Q4: å‘¨å›´è½¦æŒ‰ä»€ä¹ˆè§„åˆ™è¡Œé©¶ï¼Ÿ
**A4**: âŒ **æ²¡æœ‰å‘¨å›´è½¦**ã€‚Environment ä¸­å®Œå…¨æ²¡æœ‰å‘¨å›´è½¦è¾†çš„æ¦‚å¿µï¼Œæ›´æ²¡æœ‰å®ƒä»¬çš„è¡Œé©¶è§„åˆ™ã€‚

---

### âš ï¸ å®‰å…¨æ€§è­¦å‘Š

**å½“å‰æ¨¡å‹ä¸èƒ½ç›´æ¥ç”¨äºçœŸå®è‡ªåŠ¨é©¾é©¶ï¼**

åŸå› :
1. âŒ æ— æ³•æ„ŸçŸ¥å‘¨å›´è½¦è¾†
2. âŒ æ— æ³•åˆ¤æ–­å˜é“å®‰å…¨æ€§
3. âŒ æ²¡æœ‰ç¢°æ’é¿å…èƒ½åŠ›
4. âŒ ä¸è€ƒè™‘äº¤é€šå®‰å…¨

**å»ºè®®ç”¨é€”**:
- âœ… ä½œä¸º Low-Level Controllerï¼ˆé…åˆå®‰å…¨çš„ High-Level Plannerï¼‰
- âœ… ç ”ç©¶æ¡ä»¶åŒ–ç­–ç•¥çš„å¯è¡Œæ€§
- âœ… éªŒè¯ BC + RL æ··åˆè®­ç»ƒæ–¹æ³•
- âœ… ä½œä¸ºæ›´å¤æ‚ç³»ç»Ÿçš„ä¸€ä¸ªç»„ä»¶

---

### ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

å¦‚æœè¦åº”ç”¨åˆ°çœŸå®åœºæ™¯ï¼Œ**å¿…é¡»**:

1. **ä½¿ç”¨çœŸå® NGSIM æ•°æ®**é‡æ–°è®­ç»ƒï¼Œä¿ç•™å®Œæ•´çš„å‘¨å›´è½¦è¾†ä¿¡æ¯
2. **æ”¹è¿› Environment**ï¼Œæ¨¡æ‹ŸçœŸå®çš„å¤šè½¦äº¤äº’
3. **æ·»åŠ å®‰å…¨å±‚**ï¼Œåœ¨ Conditional Policy ä¹‹ä¸Šå¢åŠ å†³ç­–æ¨¡å—
4. **é›†æˆç¢°æ’æ£€æµ‹**å’Œå®‰å…¨æ€§çº¦æŸ
5. **åœ¨ä»¿çœŸç¯å¢ƒä¸­å……åˆ†æµ‹è¯•**åå†è€ƒè™‘å®è½¦åº”ç”¨

---

**æ–‡æ¡£åˆ›å»º**: 2025-11-10
**æœ€åæ›´æ–°**: 2025-11-10
